$(function(){var e=[],t=[],s={items:[],count:0},a=window.sessionStorage.person;if(a){var i=JSON.parse(a);personIds=i.personIds,e=personIds.split(","),t=i.personName.split(","),s=i.additem;var d=template("addedPerTpl",s);$("#addedPer").html(d)}$(document).on("click",".js-perdel",function(){var a=$(this).closest("li"),i=a.index(),d=a.data("perid");$.confirm("确定删除？",function(){var n=$("#addedCount").text();a.remove(),$("#addedCount").text(parseInt(n,10)-1),s.count=parseInt(n)-1,e.splice(i,1),t.splice(i,1),s.items.splice(i,1),$("#searchList li").each(function(e,t){$(this).data("perid")==d&&$(this).remove()})})}),$(document).on("click",".js-peradd",function(){var a=$(this);a.closest("li");$(this).hasClass("disabled")||$.confirm("确定添加?",function(){var i=$("#addedCount").text();a.addClass("disabled").html("已经添加");var d=a.closest("li").data("perid"),n=a.closest("li").data("pername"),r=a.closest("li").data("orgname");e.push(d),t.push(n);var o={id:d,orgName:r,personName:n};s.items.push(o);var l=template("addedPerTpl",s);$("#addedPer").html(l),s.count=parseInt(i,10)+1,$("#addedCount").text(parseInt(i,10)+1)})}),$("#searchBtn").on("click",function(){var t=$("#search").val().trim();t.length>0?$.ajax({type:"POST",url:api+"/contactsList/listByKeyword",data:{keyword:t,mobile:mobile},dataType:"json",beforeSend:function(e){$.showIndicator()},success:function(t){if($.hideIndicator(),1e3==t.code){var s=t.data,a="",i=s.items.length;if(i>0){for(var d=0;i>d;d++)a=s.items[d].id,$.inArray(a,e)>-1?s.items[d].isAdded=!1:s.items[d].isAdded=!0;console.log(s);var n=template("searchListTpl",s);$("#searchList").html(n)}else $("#searchList").html('<div class="tip">对不起，没有搜索结果！</div>')}else $.alert(t.msg)},error:function(e,t,s){$.hideIndicator(),$.alert("不好意思，出错了~~")}}):$.alert("请输入关键字!")}),$(document).on("click","#personAdd",function(){if(e.length>0){var a={personIds:e.join(),personName:t.join(),additem:s};window.sessionStorage.setItem("person",JSON.stringify(a)),location.href="meeting_manage.html"}else $.alert("请选择与会人员！")})});